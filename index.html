<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Scrollable Image Gallery</title>
  <style>
    body {
      margin: 0;
      background: #111;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, sans-serif;
    }
    .gallery {
      width: 100%;
    }
    .gallery img {
      width: 100%;
      display: block;
      margin-bottom: 40px;
      /* Keeps scroll physics consistent */
      aspect-ratio: 4 / 3;
      object-fit: cover;
    }
    
    /* Debug overlay */
    #debug-overlay {
      position: fixed;
      top: 10px;
      left: 10px;
      background: rgba(0, 0, 0, 0.8);
      color: #0f0;
      padding: 15px;
      font-family: monospace;
      font-size: 14px;
      border-radius: 8px;
      z-index: 9999;
      pointer-events: none;
      line-height: 1.6;
      display: none; /* Hidden by default */
    }
    #debug-overlay.visible {
      display: block;
    }
    #debug-overlay .speed {
      font-size: 24px;
      font-weight: bold;
      color: #fff;
    }
    #debug-overlay .triggered {
      color: #ff0;
    }
  </style>
</head>
<body>
  <div id="debug-overlay">
    <div>Scroll Speed Monitor</div>
    <div class="speed" id="speed-display">0.00</div>
    <div>Threshold: <span id="threshold-display">6</span></div>
    <div id="tracking-display"></div>
    <div id="status-display"></div>
  </div>
  
  <div class="gallery" id="gallery">
    <script>
  const TARGET_IMAGE = 27;
  for (let i = 1; i <= 50; i++) {
    const num = String(i).padStart(3, "0");
    const eager = i === TARGET_IMAGE ? 'loading="eager"' : 'loading="lazy"';
    document.write(
      `<img src="images/IMG_${num}.WEBP" id="img-${i}" ${eager}>`
    );
  }
</script>
  </div>
  <script>
    // --- Force scroll to top on page load (iOS Safari fix) ---
    window.history.scrollRestoration = 'manual';
    
    // Immediately scroll to top
    window.scrollTo(0, 0);
    
    // Force scroll again after DOM loads (catches iOS Safari)
    document.addEventListener('DOMContentLoaded', () => {
      window.scrollTo(0, 0);
    });
    
    // Final failsafe after everything loads
    window.addEventListener('load', () => {
      setTimeout(() => {
        window.scrollTo(0, 0);
      }, 0);
    });
    
    // --- Scroll snap logic ---
    let lastScrollY = window.scrollY;
    let lastTime = Date.now();
    let hasSnapped = false; // Only snap once per session
    let scrollTimeout = null;
    let inactivityTimeout = null;
  
    // TARGET_IMAGE already declared above - reuse it
    const SPEED_THRESHOLD = 6; // Sensitivity (lower = easier to trigger)
    const DELAY_MS = 150;        // Wait for scroll to finish before snapping
    const INACTIVITY_RESET_MS = 100; // Reset tracking after this much inactivity
    
    console.log('Scroll snap initialized');
    
    // Get debug display elements
    const speedDisplay = document.getElementById('speed-display');
    const thresholdDisplay = document.getElementById('threshold-display');
    const trackingDisplay = document.getElementById('tracking-display');
    const statusDisplay = document.getElementById('status-display');
    
    thresholdDisplay.textContent = SPEED_THRESHOLD;
    
    // --- Triple-tap to toggle debug overlay ---
    let tapCount = 0;
    let tapTimeout = null;
    const debugOverlay = document.getElementById('debug-overlay');
    
    // Wait for first image to load, then add tap listener
    window.addEventListener('load', () => {
      const firstImage = document.getElementById('img-1');
      if (firstImage) {
        firstImage.style.pointerEvents = 'auto'; // Enable pointer events on first image
        
        firstImage.addEventListener('click', (e) => {
          tapCount++;
          
          if (tapCount === 1) {
            // Start timeout for triple-tap detection
            tapTimeout = setTimeout(() => {
              tapCount = 0; // Reset if not triple-tapped in time
            }, 500); // 500ms window for triple-tap
          } else if (tapCount === 3) {
            // Triple-tap detected!
            clearTimeout(tapTimeout);
            tapCount = 0;
            
            // Toggle debug overlay
            debugOverlay.classList.toggle('visible');
            console.log('Debug overlay toggled');
          }
        });
      }
    });
    
    window.addEventListener("scroll", () => {
      // Only snap once per page load
      if (hasSnapped) {
        statusDisplay.textContent = '‚úÖ Already snapped';
        statusDisplay.className = '';
        return;
      }
      
      const now = Date.now();
      const deltaY = Math.abs(window.scrollY - lastScrollY);
      const deltaTime = now - lastTime || 1;
      const speed = deltaY / deltaTime;
      
      // Update on-screen display
      speedDisplay.textContent = speed.toFixed(2);
      speedDisplay.style.color = speed > SPEED_THRESHOLD ? '#ff0' : '#fff';
      trackingDisplay.textContent = 'üìä Tracking active';
      trackingDisplay.style.color = '#0f0';
      
      console.log('Scroll detected - Speed:', speed.toFixed(2), 'Threshold:', SPEED_THRESHOLD);
      
      // Update tracking
      lastScrollY = window.scrollY;
      lastTime = now;
      
      // Clear existing timeout
      if (scrollTimeout) clearTimeout(scrollTimeout);
      
      // Reset tracking after inactivity (prevents momentum scroll from polluting next swipe)
      if (inactivityTimeout) clearTimeout(inactivityTimeout);
      inactivityTimeout = setTimeout(() => {
        // Reset tracking so next scroll starts fresh
        lastScrollY = window.scrollY;
        lastTime = Date.now();
        trackingDisplay.textContent = 'üîÑ Tracking reset';
        trackingDisplay.style.color = '#888';
        console.log('üìç Tracking reset after inactivity');
      }, INACTIVITY_RESET_MS);
      
      // Detect fast scroll
      if (speed > SPEED_THRESHOLD) {
        console.log('üéØ Fast scroll detected! Snapping immediately');
        statusDisplay.textContent = 'üéØ SNAPPING!';
        statusDisplay.className = 'triggered';
        
        const target = document.getElementById(`img-${TARGET_IMAGE}`);
        if (target && !hasSnapped) {
          console.log('‚úÖ SNAPPING to image', TARGET_IMAGE);
          hasSnapped = true;
          
          // Snap immediately
          target.scrollIntoView({
            behavior: "smooth",
            block: "center"
          });
        } else {
          console.log('‚ùå Target not found or already snapped');
        }
      } else {
        statusDisplay.textContent = '';
      }
    });
  </script>
</body>
</html>
